#!/usr/bin/env node
'use strict';

var webpack = require('webpack')
  , WebpackDevServer = require('webpack-dev-server')
  , path = require('path')
  , config = require('../webpack.config');

const HOST = '0.0.0.0'
    , PORT = 3000

// Add hot loading options
config.entry.unshift(
  'webpack/hot/only-dev-server',
  `webpack-dev-server/client?http://${HOST}:${PORT}`
);
// loaders[0] is coffee
config.module.loaders[0].loaders.unshift('react-hot-loader/webpack');
config.plugins.unshift(new webpack.HotModuleReplacementPlugin());

new WebpackDevServer(webpack(config), {
  // Content root (with index.html)
  contentBase: path.join(__dirname, '..'),

  // Location
  publicPath: config.output.publicPath,

  // Hot reloading
  hot: true,

  // Gzip
  compress: true,

  // Allow routing
  historyApiFallback: true,

  stats: {
    // Do not show list of hundreds of files included in a bundle
    chunkModules: false,
    colors: true
  },
}).listen(PORT, HOST, (err, result) => {
  console.log(err || `Listening at ${HOST}:${PORT}`);
});
